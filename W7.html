<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>TON Transfer</title>

  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

  <style>
    body{
      font-family: sans-serif;
      padding: 30px;
      text-align:center;
    }
    input{
      padding:8px;
      font-size:16px;
      margin:5px;
      width: 260px;
    }
    button{
      padding:10px 20px;
      font-size:16px;
      margin-top:10px;
    }
  </style>
</head>

<body>

  <!-- دکمه اتصال کیف پول -->
  <div id="ton-connect"></div>

  <h3>ارسال TON</h3>

  <input id="address" placeholder="آدرس گیرنده" /><br>
  <input id="amount" placeholder="مقدار TON" /><br>

  <button onclick="sendTon()">ارسال TON</button>

  <p id="status">وضعیت: متصل نیست</p>

  <script>

    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: "https://solider1385.github.io/Best-Coin.io/tonconnect-manifest.json",
      buttonRootId: "ton-connect"
    });

    tonConnectUI.onStatusChange((wallet)=>{
      if(wallet){
        document.getElementById("status").innerText =
          "متصل شد! آدرس: " + wallet.account.address;
      } else {
        document.getElementById("status").innerText = "متصل نیست";
      }
    });

    async function sendTon(){

      const toAddress = document.getElementById("address").value.trim();
      const amountTon = document.getElementById("amount").value.trim();

      if(!toAddress || !amountTon){
        alert("لطفاً آدرس و مقدار را وارد کن");
        return;
      }

      const nanoTon = Math.floor(Number(amountTon) * 1e9);

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 300, // ۵ دقیقه
        messages: [
          {
            address: toAddress,
            amount: nanoTon.toString()
          }
        ]
      };

      try{
        const res = await tonConnectUI.sendTransaction(tx);
        alert("تراکنش ارسال شد!");
        console.log(res);
      }catch(e){
        alert("خطا در ارسال تراکنش: " + e.message);
        console.error(e);
      }
    }

  </script>

</body>
</html>
