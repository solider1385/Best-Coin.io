<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TON Connect - MiniApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
</head>
<body>

<button id="connectBtn">اتصال کیف پول</button>

<div id="info"></div>

<script>
const manifestUrl = "https://solider1385.github.io/Best-Coin.io/tonconnect-manifest.json";

// TONConnect
const tonConnect = new TON_CONNECT.TonConnect({ manifestUrl });

// ✅ اتصال کیف پول
document.getElementById("connectBtn").onclick = async () => {
    try {
        const wallets = await tonConnect.getWallets();
        console.log(wallets);

        // نمایش لیست Wallet‌ها با Popup تلگرام
        Telegram.WebApp.showPopup(
            {
                title: "انتخاب کیف پول",
                message: "یک کیف پول انتخاب کن",
                buttons: wallets.map((w) => ({
                    id: w.name,
                    type: "default",
                    text: w.name,
                })),
            },
            async (id) => {
                const wallet = wallets.find((w) => w.name === id);
                if (!wallet) return;

                try {
                    await tonConnect.connect({
                        universalLink: wallet.universalLink,
                        bridgeUrl: wallet.bridgeUrl,
                    });

                    document.getElementById("info").innerHTML = "✅ کیف پول وصل شد!";
                } catch (e) {
                    console.error(e);
                    alert("❌ خطا هنگام اتصال");
                }
            }
        );
    } catch (err) {
        console.error(err);
        alert("❌ مشکل هنگام دریافت کیف‌پول‌ها");
    }
};


// ✅ وقتی اتصال انجام شد → نمایش آدرس
tonConnect.onStatusChange((wallet) => {
    if (wallet) {
        document.getElementById("info").innerHTML = `
            ✅ متصل شد
            <br> <b>آدرس:</b> ${wallet.account.address}
        `;
    }
});

</script>

</body>
</html>
