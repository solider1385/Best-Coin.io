<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>TON Payment</title>
</head>
<body>

<button id="connectBtn">اتصال کیف‌پول</button>

<div id="transferUI" style="display:none; margin-top:20px;">
    <input id="amount" placeholder="مقدار TON" />
    <button id="sendBtn">ارسال</button>
</div>

<script type="module">
import { TonConnect } from "https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js";

const manifestUrl = "https://solider1385.github.io/Best-Coin.io/tonconnect-manifest.json";   // ✅ فایل مانفیست

const TARGET_ADDRESS = "UQB_6hVTqsjZmNx-69Dbn0ON8t8zy45zMF9iFqZ4DAPeJ2oi";   // ✅ اینو با آدرس مقصد عوض کن

const tonConnect = new TonConnect({ manifestUrl });

const connectBtn = document.getElementById("connectBtn");
const transferUI = document.getElementById("transferUI");
const sendBtn = document.getElementById("sendBtn");
const amountInput = document.getElementById("amount");


// =======================
// اتصال کیف‌پول
// =======================
connectBtn.onclick = async () => {
    try {
        await tonConnect.connectWallet();
        alert("✅ کیف‌پول با موفقیت وصل شد!");
        transferUI.style.display = "block";
    } catch(e) {
        alert("❌ خطا در اتصال");
        console.log(e);
    }
};


// =======================
// ارسال تراکنش
// =======================
sendBtn.onclick = async () => {

    const amountTON = Number(amountInput.value);
    if (!amountTON) {
        alert("مقدار TON را درست وارد کنید");
        return;
    }

    // تبدیل TON به nanoTON
    const nano = BigInt(Math.floor(amountTON * 1e9));

    const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 300,
        messages: [{
            address: TARGET_ADDRESS,
            amount: nano.toString()
        }]
    };

    try {
        await tonConnect.sendTransaction(tx);
        alert("✅ تراکنش ارسال شد!");
    } catch(err) {
        alert("❌ خطا در ارسال تراکنش");
        console.log(err);
    }
};

</script>

</body>
</html>
