<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<title>TON Connect Test</title>
</head>
<body>

<button id="connectBtn">اتصال کیف‌پول</button>

<div id="transfer" style="display:none; margin-top:20px;">
    <input id="amount" type="number" placeholder="مقدار TON" />
    <button id="sendBtn">ارسال</button>
</div>


<script type="module">
import { TonConnectUI } from "https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js";

const manifestUrl = "https://solider1385.github.io/Best-Coin.io/tonconnect-manifest.json";

// ✅ کیف پول مقصد (عوض کن)
const TARGET_WALLET = "UQB_6hVTqsjZmNx-69Dbn0ON8t8zy45zMF9iFqZ4DAPeJ2oi";

// ایجاد TonConnect
const tonUI = new TonConnectUI({
    manifestUrl
});


/* عناصر UI */
const connectBtn = document.getElementById("connectBtn");
const sendBtn = document.getElementById("sendBtn");
const transferDiv = document.getElementById("transfer");
const amountInput = document.getElementById("amount");


//============== اتصال کیف پول (Popup) ==============
connectBtn.onclick = async () => {
    try {
        await tonUI.openModal();   // ✅ پاپ‌آپ رسمی
        tonUI.onStatusChange((wallet) => {
            if (wallet) {
                alert("✅ کیف‌پول با موفقیت متصل شد");
                transferDiv.style.display = "block";
            }
        });
    } catch (e) {
        console.log("خطا:", e);
    }
};


//============== ارسال تراکنش ==============
sendBtn.onclick = async () => {

    const ton = Number(amountInput.value);

    if (!ton || ton <= 0) {
        alert("❌ مقدار TON نامعتبر است");
        return;
    }

    const nano = BigInt(Math.floor(ton * 1e9));

    const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 300,
        messages: [
            {
                address: TARGET_WALLET,
                amount: nano.toString()
            }
        ]
    };

    try {
        await tonUI.sendTransaction(tx);
        alert("✅ تراکنش ارسال شد!");
    } catch (e) {
        console.log(e);
        alert("❌ خطا در ارسال تراکنش");
    }
};
</script>

</body>
</html>
